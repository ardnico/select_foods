# プロジェクト計画 (PROJECT_PLAN.md)

## 1. プロジェクト概要

- 一文サマリ:  
  - iPadで「期間指定の献立（昼・夜）」を決めると、必要な材料を自動集計してくれる献立・買い物支援アプリ。

- 想定ユーザー:
  - 家庭の料理担当者（1〜4人家族を想定）
  - 週単位で献立をまとめて決めたい人
  - 「レシピアプリは多すぎて管理が面倒、買い物リストだけ欲しい」タイプのユーザー
  - 自分自身（開発者）も日常的に使うヘビーユーザー

- 背景 / なぜ作るか:
  - 献立を日々その場で決めていると、判断コストが高い・同じメニューばかりになる・買い忘れや買い過ぎが発生しやすい。
  - 一般的なレシピアプリは「レシピ探索」は得意だが、「期間で献立を組む＋材料を集計する」部分が重くて、継続利用しづらい。
  - iPadでソファに座りながら、数日〜1週間分の昼・夜メニューをサクッと決めて、そのまま材料リストを出して買い物に行けるワークフローを作りたい。


## 2. ゴール / 非ゴール

### 2.1 ゴール（成功条件）

- G1: 1週間分（7日×昼夜）の献立を決める作業を、紙と電卓より**体感50%以上**早く・楽にできる。
- G2: 指定期間に必要な材料を、同じ材料・同じ単位ごとに**合算して一覧表示**できる。
- G3: メニューを「種類」や「種類セット」で絞り込んで選択でき、ジャンルバランスを取りやすい。
- G4: オフライン（ネット接続なし）でも、献立作成と材料集計がすべて完結する。
- G5: アプリ初回起動から5分以内に、「1〜2日分の献立を作って材料一覧を見る」まで到達できる操作性。

### 2.2 非ゴール（やらないこと）

- NG1: 詳細なレシピ手順・写真付きレシピサイト並みのコンテンツ提供。
- NG2: 複数端末（iPhone/他iPad/macOS）とのリアルタイム同期・共同編集。
- NG3: 栄養計算（カロリー・PFCバランスなど）の自動計算機能。
- NG4: ECサイトへの自動発注やスーパーの在庫・価格情報との連携。
- NG5: 世の中すべてのレシピを網羅した汎用レシピ検索エンジン。（あくまで「自分の登録した・用意したメニュー」中心）


## 3. 制約

- 言語 / フレームワーク:
  - Swift + SwiftUI
- 対応 OS / デバイス:
  - iPadOS 17 以降
  - 縦横どちらの画面向きにも対応（優先は横向き）
- データ保存:
  - ローカルDB（Core Data または SQLite ラッパー）を利用
  - 外部APIやクラウド依存なし（v1では完全オフライン前提）
- 外部サービス:
  - レシピAPI・ログイン機構などには依存しない
- 想定開発期間:
  - 約 4〜6 週間で MVP（1人開発前提、平日夜＋週末ペース）


## 4. 全体アーキテクチャ（ざっくり）

- プレゼンテーション層（UI / 画面）
  - SwiftUI View 群
  - 画面例:
    - 期間選択画面
    - 日別・昼夜献立編集画面
    - メニュー選択モーダル（種類・種類セットフィルタ付き）
    - 材料集計画面
    - メニュー管理画面（簡易）

- アプリケーション層（状態管理）
  - ObservableObject / Store 的な層で、以下を管理:
    - 現在のPlan（期間・日付一覧）
    - 日付ごとの昼/夜メニュー割当て
    - メニュー一覧・種類・種類セット
    - 材料集計結果
  - 単一責任を意識し、PlanStore / MenuStore などに分割

- ドメイン層
  - エンティティ:
    - Plan / PlanDay
    - Menu / MenuType / MenuTypeSet
    - Ingredient / MenuIngredient
  - ドメインロジック:
    - 材料集計ロジック
    - 期間変更時のPlanDay再構成
    - 種類セットによるメニュー絞り込み

- インフラ層（永続化）
  - Repositoryパターンで抽象化:
    - PlanRepository
    - MenuRepository
    - IngredientRepository
  - 具体実装として Core Data / SQLite を隠蔽

- テスト:
  - ドメインロジック（材料集計・期間変更など）はユニットテスト対象
  - UIはスナップショットテストや手動テスト中心（MVPでは最低限）


## 5. 優先機能（MVPスコープ）

- M1: 期間設定機能
  - 開始日・終了日を指定し、その期間の日付リストを生成。
  - 期間を変更すると、PlanDayが再計算される（範囲外の日付の献立は削除）。

- M2: 日別・昼夜メニュー割り当て
  - 各日付の「昼」「夜」にメニューを1つずつ設定・変更・クリア可能。

- M3: メニュー一覧 + 種類フィルタ
  - メニューに「種類（和食/洋食/…）」を持たせ、種類でフィルタして選択できる。

- M4: 種類セットによるメニュー絞り込み
  - 「和食中心」「時短」「ヘルシー」などの種類セットから、対象メニューだけをリスト表示して選択できる。
  - v1では種類セットはアプリ内固定定義（ユーザー編集は後回し）。

- M5: 材料の集計
  - 指定期間内の全メニューに含まれる材料を、材料名＋単位ごとに合算。
  - 材料一覧として表示（材料名 / 合計量 / 単位）。

- M6: 献立一覧画面
  - 指定期間の「日付ごとの昼・夜メニュー」を一覧表示する画面。
  - ここから日別編集画面へジャンプ可能。

- M7: メニューの簡易管理
  - アプリ同梱のサンプルメニューを読み込み。
  - 簡易的にメニューを新規追加できるUI（名前・種類・材料リスト）を提供。


## 6. 非機能要件

- パフォーマンス:
  - 1週間分（14メニュー）程度の献立であれば、材料集計処理はほぼ即時（体感0.5秒未満）。
  - メニュー数が100件程度でも、メニュー選択画面のスクロール・フィルタがストレスなく動作。

- ユーザビリティ:
  - 初見ユーザーがチュートリアルなしで、「期間設定→献立入力→材料一覧」の流れを完走できる。
  - 主な操作はタップと簡単なスクロールに収まる（複雑なフォーム入力を避ける）。

- 信頼性:
  - アプリクラッシュや強制終了が発生しても、直前までの献立データ・メニュー・材料データはローカル保存されている。
  - バリデーション:
    - メニュー追加時、材料名や単位が空のまま保存されないよう最低限チェック。

- メンテナンス性:
  - ドメインロジックはUIから分離し、テスト可能な関数として実装。
  - データモデル（エンティティ）とUIモデルを分離し、肥大化を防ぐ。

- ログ:
  - v1では本格的なログ仕組みは不要。
  - 開発時のみ、コンソールログで主要イベントを確認できる程度。


## 7. リスクと対応

- R1: 材料の単位がバラバラで正しく集計できない
  - 例: 同じ「玉ねぎ」でも「個」と「g」が混在する。
  - 対応:
    - v1では「同じ材料名＋同じ単位のみ集計対象」という仕様に割り切る。
    - 材料登録画面で、基本的な単位候補（個/g/ml/本など）を絞り込んで選ばせる。

- R2: メニュー数・種類・種類セットが増えるとUIが複雑化する
  - 対応:
    - MVPではメニュー種類を5〜7種、種類セットを3〜5個程度に制限。
    - メニュー選択モーダルのフィルタUIをシンプルに保つ（トグル・サイドバーなど）。

- R3: 初期メニューの質が低いと、ユーザー体験が微妙になる
  - 対応:
    - よく使う家庭料理を20〜30件に絞って用意し、「普段使い料理」に振り切る。
    - 将来バージョンでユーザーの自作メニューを増やしていく前提。

- R4: 自分の開発時間確保ができず、MVPがダラダラ延びる
  - 対応:
    - フェーズを明確に分けて、「Phase 1完了で一旦使える状態」を作る。
    - UIの凝り方より、まずは「材料集計」まで通る動線を最優先に実装。


## 8. 開発フロー

- フェーズ分割:
  - Phase 1: データモデルとローカル保存（Plan / Menu / Ingredient のCRUD）
  - Phase 2: 献立編集UI（日別・昼夜割り当て）
  - Phase 3: 材料集計ロジックと集計画面
  - Phase 4: 種類・種類セットのフィルタ機能 + メニュー管理UI

- タスク管理:
  - GitHub Issues or 自前のチケットで「機能単位」で小さく切る。
  - 各Issueは「UI」「ロジック」「永続化」の3つの観点でDone条件を決める。

- 実装スタイル:
  - ドメインロジック（集計・期間処理）は、PlaygroundやUnit Testで先に実装・検証。
  - UIは仮データで組んだ後、Repository接続に差し替える。

- レビュー/振り返り:
  - 各フェーズ完了時に、「実際に1週間分の献立を作って材料一覧を出す」手動テストを行い、UXの詰まりを洗い出す。


## 9. オープンな検討事項

- Q1: メニューの初期データをどの程度用意するか
  - 例: 20件程度のサンプルか、50件程度まで増やすか。
  - 実データの入力コストとMVPスコープのバランス。

- Q2: ユーザーがメニュー・材料をどこまで自由に追加・編集できるようにするか
  - MVPでは「追加・簡易編集」までに絞るか、削除まで含めるか。

- Q3: 今後の拡張として、iPhone版やiCloud同期をどのタイミングで考慮するか
  - 初版からアーキテクチャだけは複数デバイスの拡張を意識しておくかどうか。

- Q4: 複数人家族用の機能（人数変更による材料倍率など）をいつ入れるか
  - v1では人数固定（例: 2〜3人前）にしておき、将来拡張とするか。

- Q5: UIデザインのレベルをどこまでやるか
  - 自前デザインで最低限整えるのか、後からデザイナー投入前提で暫定UIにしておくか。

---
この計画を前提にすると、いまのボトルネックは「MVPの範囲をさらに絞りきること」で、まず壊すべきは「UIに凝る欲」と「レシピ数を増やしすぎる欲」。最初は「期間設定＋献立入力＋材料集計」の一本線だけ通すところから着手するのが筋がいい。
